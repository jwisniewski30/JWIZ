---
title: "Assignment 5"
author: "Justin Wisniewski"
date: '2022-05-01'
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include = FALSE}
library(dplyr)
library(Hmisc)
library(ltm)
students <- read.csv("student-survey.csv")
flattenCorrMatrix <- function(cormat, pmat) {
  ut <- upper.tri(cormat)
  data.frame(
    row = rownames(cormat)[row(cormat)[ut]],
    column = rownames(cormat)[col(cormat)[ut]],
    cor  =(cormat)[ut],
    p = pmat[ut]
  )
}
cor.table <- function(dataset, pvalue, correlationtype) {
  x <- rcorr(as.matrix(dataset), type = correlationtype)
  x <- flattenCorrMatrix(x$r,x$P)
  x <- x %>% 
    filter(p <= pvalue) %>%
    arrange(p)
}
```

```{r}
cov(students)
```
## Use R to calculate the covariance of the survey variables and provide an explanation of why you would use this calculation and what the results indicate.
Since the TimeReading and TimeTV units are not identical, the covariance helps paint a better picture. The two have a negative covariance. This means that as you spend more time reading you will spend less time watching TV and vice versa.

## Examine the Survey data variables. What measurement is being used for the variables? Explain what effect changing the measurement being used for the variables would have on the covariance calculation. Would this be a problem? Explain and provide a better alternative if needed.
It appears that TimeReading is in hours, TimeTV is minutes, and Gender is just a simple binary coding for male/female. Also, what unit does one measure "happiness" in? Possibly a percentage. Changing the measurements to have consistent units would make it easier to interpret, but in this scenario not possible. In this case, using correlation would be more effective since it can compare relationships regardless of the units.

## Choose the type of correlation test to perform, explain why you chose this test, and make a prediction if the test yields a positive or negative correlation?
I chose to do a few different types of correlation tests to give me a better understanding of each and timereading vs happiness, as well as timetv vs happiness.  My prediction would be a positive correlation for tv, negative for reading.  As the results show below, all tests appear to confirm prediction.

```{r}
cor(students$TimeReading,students$Happiness, method=c("spearman"))
cor(students$TimeReading,students$Happiness, method=c("kendall"))
cor(students$TimeReading,students$Happiness, method=c("pearson"))

cor(students$TimeTV,students$Happiness, method=c("kendall"))
cor(students$TimeTV,students$Happiness, method=c("spearman"))
cor(students$TimeTV,students$Happiness, method=c("pearson"))
```

## Perform a correlation analysis of: All variables, A single correlation between two pairs of the variables, and describe what the calculations in the correlation matrix suggest about the relationship between the variables. Be specific with your explanation.
``` {r, echo = FALSE}
(cor.table(students, .99, "pearson"))
```

``` {r}
biserial.cor(students$TimeReading, students$Gender)
biserial.cor(students$TimeTV, students$Gender)
biserial.cor(students$Happiness, students$Gender)
```

With alpha level of .05 or 95% confidence, the only significant correlations are TimeReading/TimeTV and TimeTV/TimeHappiness. With an alpha level of .01 or 99% confidence, then our only significant correlation would be TimeReading/TimeTV.

## Calculate the correlation coefficient and the coefficient of determination, describe what you conclude about the results
``` {r, echo = FALSE}
students_r2 <- cor.table(students, .99, "pearson")
students_r2 <- students_r2[,-4]
students_r2$cor <- students_r2$cor * students_r2$cor
colnames(students_r2)[3] <- "R^2"
head(students_r2)
``` 

R-squared value of 78% is significant.  TimeReading/TimeTV as well as TimeTV/Happiness appear to have a fairly larger value than any others.

## Based on your analysis can you say that watching more TV caused students to read less? Explain.
Correlation does not necessarily mean causation. Given a 24 hour day, if a student was to watch more tv than it seems safe to assume there would be less time to read.  However, that isn't necessarily the case if a student was to watch tv more as well as read more.

## Pick three variables and perform a partial correlation, documenting which variable you are “controlling”. Explain how this changes your interpretation and explanation of the results.
``` {r, include = FALSE}
library(ggm)
pcr1 <- pcor(c("TimeTV", "Happiness", "TimeReading"), var(students))
```

``` {r}
# Partial Correlation of TimeTv vs. Happiness, while controlling for "TimeReading"
pcr1
# R^2 of TimeTV vs. Happiness, while controlling for "TimeReading"
pcr1 * pcr1 
```

The correlation weakened and R^2 went down. TimeReading accounted for a significant amount of variability in TimeTV. Furthermore, TimeReading had a negative correlation with Happiness.